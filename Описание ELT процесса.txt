JOB (задание): dwh_itog_job_exec.kjb

Загрузка данных в хранилище выполняется как JOB (задание) с параметрами : 
 начало и конец периода выборки данных о перелетах пассажиров
 параметры period_dat1 и period_dat2 передаются в каждую трансформацию задания
 как параметры трансформации period_dt1 и period_dt2.

Должны выполниться 4 трансформации. 
Файлы трансформаций должны находится в той же дирректории, что и файл задания.

dwh_itog_dim_aircrafts.ktr  - 
	обновление и дополнения 2 измерений dbflights.dim_aircrafts и dbflights.dim_airports.
	
	Проверка качества aircrafts с выгрузкой ошибочных строк 
	в схему err_dbflights таблица err_aircraft_rows.
	Проверка: 
	1. Границы значения атрибута max_range между 1000 и 19000.
	2. Наличие недопустимых символов в поле model. 
	   Допустимы только буквы,цифры, символ "-" или пробел.
	3. Наличие недопустимых символов в поле aircraft_code. 
	   Допустимы только заглавные латинские буквы и цифры 0-9.
	Поддержка версий и периода актуальности атрибутов: model,max_range.

	Проверка качества airports с выгрузкой ошибочных строк 
	в схему err_dbflights таблица err_airport_rows.
	Проверка: 
	1. Границы значения атрибута longitude (долгота) между 0 и 180.
	2. Границы значения атрибута latitude (широта) между 0 и 90.
	3. Наличие недопустимых символов в поле city (город). 
	   Допустимы только буквы,цифры, символ "-" или пробел.
	4. Наличие недопустимых символов в поле airport_name (аэропорт). 
	   Допустимы только буквы,цифры, символ "-" или пробел.
	Поддержка версий и периода актуальности атрибутов: airport_name,city,
	longitude,latitude,timezone.

dwh_itog_dim_pass.ktr
	обновление и дополнение измерения dbflights.dim_passengers.
	Пассажир идентифицируется как пара атрибутов pass_document и pass_name
	(натуральный ключ). Данные отбираются из таблицы bookings.tickets.
	Контактные данные из атрибута (JSONB) раскрываются в атрибуты email и phone.
 
	Проверка качества для dim_passengers с выгрузкой ошибочных строк 
	в схему err_dbflights таблица err_passenger_rows.
	Проверка: 
	1. Атрибут email либо NULL, либо строка не более 50 символов.
	   (можно добавить проверку на соответствие интернет-адресу).
	2. Атрибут phone либо NULL, либо строка не более 20 символов.
	3. Наличие недопустимых символов в поле имени пассажира. 
	   Допустимы только заглавные латинские буквы, символ "-" или пробел.
	4. Наличие недопустимых символов в поле passenger_id документ пассажира. 
	   Допустимы только цифры 0-9, символ "-" или пробел.
	Поддержка версий и периода актуальности атрибутов: pass_email,pass_phone.

dwh_itog_dim_tarif.ktr
	обновление и дополнение измерения dbflights.dim_tarif.
	Попытка сформировать тарифную сетку с атрибутами : дата полета, самолет,
	аэропорт вылета, аэропорт прилета, класс обслуживания, тариф.

	Проверка качества для dim_tarif с выгрузкой ошибочных строк 
	в схему err_dbflights таблица err_tarif_rows.
	Проверка: 
	1. Границы значения amount между 0.1 и 500000.00
	2. Наличие недопустимых символов в поле aircraft_code. 
	   Допустимы только заглавные латинские буквы и цифры 0-9.
	3. Наличие неформальных значений в поле klass класс обслуживания. 
	   Допустимы,указанные в перечислении: Business,Economy,Comfort.
	Поддержка версий и периода актуальности атрибута: price.
	

dwh_itog_fact_flights.ktr
	обновление и дополнение таблицы фактов dbflights.fact_flights.
	
	Проверка качества для fact_flights с выгрузкой ошибочных строк 
	в схему err_dbflights таблица err_flight_rows.
	Проверка: 
	1. Дата прилета больше даты period_dt1 (параметр)
	2. Границы значения amount между 0.1 и 500000.00
	3. Наличие недопустимых символов в поле имени пассажира. 
	   Допустимы только заглавные латинские буквы, символ "-" или пробел.
	4. Наличие недопустимых символов в поле passenger_id документ пассажира. 
	   Допустимы только цифры 0-9, символ "-" или пробел.

	Перезагрузка связанных данных по пассажиру - dim_passengers.pass_id (cуррогатный ключ)
	ассоциированный с парой атрибутов pass_document и pass_name.
	Перезагрузка связанных данных по самолету - dim_aircrafts.id (cуррогатный ключ)
	ассоциированный с атрибутом aircraft_code.
	Перезагрузка связанных данных по аэропорту вылета - dim_airports.id (cуррогатный ключ)
	ассоциированный с атрибутом airport_start = dim_airports.airport_code.
	Перезагрузка связанных данных по аэропорту прилета - dim_airports.id (cуррогатный ключ)
	ассоциированный с атрибутом airport_end = dim_airports.airport_code.
	Перезагрузка связанных данных даты вылета с календарем - dim_canendar.id (cуррогатный ключ)
	ассоциированный с атрибутом dt_start = dim_canendar.fact_date.
	
	Запись текущей даты как даты добавления данных в таблицу фактов - атрибут fact_flights.date_ts

